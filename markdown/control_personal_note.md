# 动力学与控制 · 笔记

---

先给出两个重要的附录。

## A 贯穿整个笔记的一个例子

以下给出**图示两级质量–弹簧–阻尼系统**的完整建模与推导：

<img src="/fig/Two_Stage_Mass_Spring_Damping_System_Inverted.png" alt="理想两级质量–弹簧–阻尼系统" width="95%">

###  A.1 动力学建模

系统描述：  
- 质量块 $ m_1 $ 与地基通过 $ k_1, c_1 $ 相连；  
- 质量块 $ m_2 $ 通过 $ k_2, c_2 $ 与 $ m_1 $ 相连；  
- 地基存在位移扰动 $ w(t) $；  
- 驱动力 $ f(t) $ 作用于 $ m_1 $；  
- 输出常取相对位移 $ \Delta x = x_2 - x_1 $。  

约定竖直向上为正，所有元件线性、小振动，重力静挠度吸收入平衡点（故不显式出现 $ mg $）。

广义坐标 $ q = [x_1, x_2]^T $，地基位移 $ w(t) $ 为外部已知函数。

**动能：**
$$
T = \tfrac{1}{2} m_1 \dot{x}_1^2 + \tfrac{1}{2} m_2 \dot{x}_2^2
$$

**势能：**
$$
V = \tfrac{1}{2} k_1 (x_1 - w)^2 + \tfrac{1}{2} k_2 (x_2 - x_1)^2
$$

**Rayleigh 阻尼函数：**
$$
\mathcal{D} = \tfrac{1}{2} c_1 (\dot{x}_1 - \dot{w})^2 + \tfrac{1}{2} c_2 (\dot{x}_2 - \dot{x}_1)^2
$$

**非保守广义力：**
$$
Q_1 = f, \quad Q_2 = 0
$$

带耗散的 Lagrange 方程：
$$
\frac{d}{dt} \Big( \frac{\partial T}{\partial \dot{x}_i} \Big) - \frac{\partial T}{\partial x_i} + \frac{\partial \mathcal{D}}{\partial \dot{x}_i} + \frac{\partial V}{\partial x_i} = Q_i, \quad (i = 1,2)
$$

逐项求导并整理：
$$
\boxed{\begin{aligned}
m_1 \ddot{x}_1 &= -k_1 (x_1 - w) - c_1 (\dot{x}_1 - \dot{w}) + k_2 (x_2 - x_1) + c_2 (\dot{x}_2 - \dot{x}_1) + f, \\
m_2 \ddot{x}_2 &= -k_2 (x_2 - x_1) - c_2 (\dot{x}_2 - \dot{x}_1)
\end{aligned}}
$$

将 $x_1, x_2, w$ 的项分离，即得矩阵形式：
$$
M \ddot{x} + C \dot{x} + K x = b_f f + b_1 \dot{w} + b_0 w
$$



### A.2 相对地基坐标形式（仅含 $\ddot{w}$）

令：
$$
r_1 = x_1 - w, \quad r_2 = x_2 - w, \quad r = [r_1, r_2]^T
$$

则：
$$
\dot{r} = \dot{x} - \dot{w} \mathbf{1}, \quad
\ddot{r} = \ddot{x} - \ddot{w} \mathbf{1}, \quad
\mathbf{1} = [1, 1]^T
$$

代入并整理：
$$
M \ddot{r} + C \dot{r} + K r = b_f f - M \mathbf{1} \ddot{w}
$$

即：
$$
\boxed{\begin{aligned}
m_1 \ddot{r}_1 + (c_1 + c_2)\dot{r}_1 - c_2 \dot{r}_2 + (k_1 + k_2) r_1 - k_2 r_2 &= f - m_1 \ddot{w}, \\
m_2 \ddot{r}_2 + c_2 \dot{r}_2 - c_2 \dot{r}_1 + k_2 r_2 - k_2 r_1 &= -m_2 \ddot{w}.
\end{aligned}}
$$

测量量关系：
$$
x_1 = r_1 + w, \quad x_2 = r_2 + w, \quad \Delta x = r_2 - r_1.
$$

此表述避免了速度输入 $\dot{w}$，便于将地基扰动视为**基座加速度输入** $\ddot{w}$。

### A.3 状态空间表达

取状态向量：
$$
z = [x_1, x_2, \dot{x}_1, \dot{x}_2]^T, \quad u = [f, w, \dot{w}]^T
$$

则：
$$
\dot{z} =
\underbrace{
\begin{bmatrix}
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1 \\
-\frac{k_1 + k_2}{m_1} & \frac{k_2}{m_1} & -\frac{c_1 + c_2}{m_1} & \frac{c_2}{m_1} \\
\frac{k_2}{m_2} & -\frac{k_2}{m_2} & \frac{c_2}{m_2} & -\frac{c_2}{m_2}
\end{bmatrix}
}_{A}
z
+
\underbrace{
\begin{bmatrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
\frac{1}{m_1} & \frac{k_1}{m_1} & \frac{c_1}{m_1} \\
0 & 0 & 0
\end{bmatrix}
}_{B}u
$$

输出：

$$
y =
\begin{bmatrix}
x_1 \\ x_2 \\ \Delta x
\end{bmatrix}
=\underbrace{
\begin{bmatrix}
1 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 \\
-1 & 1 & 0 & 0
\end{bmatrix}
}_{C}
z
$$

若采用相对坐标 $r$，输入可改为 $[f, \ddot{w}]$，并将 $B$ 的第二列替换为
$[ -1, 0, -m_1^{-1}, -m_2^{-1} ]^T$。

### A.4 整理一下常用的核心公式

**标准 $x_1$，$x_2$的微分方程组（非矩阵形式）**

$$
\boxed{
\begin{aligned}
m_1\ddot x_1+(c_1+c_2)\dot x_1-c_2\dot x_2+(k_1+k_2)x_1-k_2x_2 &= f+c_1\dot w+k_1 w,\\
m_2\ddot x_2-c_2\dot x_1+c_2\dot x_2-k_2x_1+k_2x_2 &= 0.
\end{aligned}}
$$

**标准 A、B、C、D 矩阵**

$$z=\begin{bmatrix}x_1\\x_2\\\dot x_1\\\dot x_2\end{bmatrix},\qquad
u=\begin{bmatrix}f\\ w\\ \dot w\end{bmatrix},\qquad
y=\begin{bmatrix}x_1\\ x_2\\ \Delta x\end{bmatrix},\ \Delta x=x_2-x_1.$$

$$
A=
\begin{bmatrix}
0&0&1&0\\
0&0&0&1\\
-\dfrac{k_1+k_2}{m_1}&\dfrac{k_2}{m_1}&-\dfrac{c_1+c_2}{m_1}&\dfrac{c_2}{m_1}\\[3mm]
\dfrac{k_2}{m_2}&-\dfrac{k_2}{m_2}&\dfrac{c_2}{m_2}&-\dfrac{c_2}{m_2}
\end{bmatrix},
\quad
B=
\begin{bmatrix}
0&0&0\\
0&0&0\\
\dfrac{1}{m_1}&\dfrac{k_1}{m_1}&\dfrac{c_1}{m_1}\\[2mm]
0&0&0
\end{bmatrix},
C=
\begin{bmatrix}
1&0&0&0\\
0&1&0&0\\
-1&1&0&0
\end{bmatrix},\qquad
D=\mathbf{0}_{3\times 3}.
$$

相对坐标下的微分方程组（非矩阵形式）

$$
\boxed{
\begin{aligned}
m_1\ddot r_1+(c_1+c_2)\dot r_1-c_2\dot r_2+(k_1+k_2)r_1-k_2 r_2 &= f- m_1\ddot w,\\
m_2\ddot r_2-c_2\dot r_1+c_2\dot r_2-k_2 r_1+k_2 r_2 &= - m_2\ddot w.
\end{aligned}}
$$

相对坐标下的 A、B、C、D 矩阵

$$
z_r=\begin{bmatrix}r_1\\ r_2\\ \dot r_1\\ \dot r_2\end{bmatrix},\qquad
u_r=\begin{bmatrix}f\\ \ddot w\end{bmatrix},\qquad
y_r=\begin{bmatrix}r_1\\ r_2\\ \Delta x\end{bmatrix},\ \Delta x=r_2-r_1,
$$

$$
A_r=
\begin{bmatrix}
0&0&1&0\\
0&0&0&1\\
-\dfrac{k_1+k_2}{m_1}&\dfrac{k_2}{m_1}&-\dfrac{c_1+c_2}{m_1}&\dfrac{c_2}{m_1}\\[3mm]
\dfrac{k_2}{m_2}&-\dfrac{k_2}{m_2}&\dfrac{c_2}{m_2}&-\dfrac{c_2}{m_2}
\end{bmatrix},
\quad
B_r=
\begin{bmatrix}
0&0\\
0&0\\
\dfrac{1}{m_1}&-1\\[2mm]
0&-1
\end{bmatrix},
C_r=
\begin{bmatrix}
1&0&0&0\\
0&1&0&0\\
-1&1&0&0
\end{bmatrix},\qquad
D_r=\mathbf{0}_{3\times 2}.
$$

### A.5 传递函数

动刚度矩阵：
$$
A(s) = Ms^2 + Cs + K =
\begin{bmatrix}
A_{11} & A_{12} \\
A_{21} & A_{22}
\end{bmatrix}
$$

其中：
$$
A_{11} = m_1 s^2 + (c_1 + c_2)s + (k_1 + k_2), \quad
A_{22} = m_2 s^2 + c_2 s + k_2, \quad
A_{12} = A_{21} = -(c_2 s + k_2).
$$

公共分母（四阶多项式）：
$$
\boxed{
D(s) = \det A(s)
= m_1 m_2 s^4+ [m_1 c_2 + m_2 (c_1 + c_2)] s^3+ [m_1 k_2 + m_2 (k_1 + k_2) + c_1 c_2] s^2+ (c_1 k_2 + c_2 k_1) s + k_1 k_2
}
$$

$$
\boxed{
\frac{\Delta X(s)}{F(s)} = \frac{-m_2 s^2}{D(s)}, \qquad
\frac{\Delta X(s)}{W(s)} = \frac{-m_2 s^2 (c_1 s + k_1)}{D(s)}
}
$$

基于上述传递函数解析表达，我们可以绘制出 Bode 图，并进行稳定裕度的分析，这将是后续环路整形的重要基础。

### A.6 Simulink 仿真模型搭建

> 惊人的发现，Simulink 做仿真好像比 Python 好用太多了……

基于上面整理的四种表达，我在 Simulink 里搭建了四种系统模型，如下所示，相关文件下载见[笔记](\notes)。

### A.7 关于两级质量-弹簧-阻尼系统的应用场景

## B 控制器设计实践

---

以下是知识性笔记整理。

## 1 信号与系统

### 1.1 信号的基本概念

#### 1.1.1 分类

* **连续时间信号 (Continuous-Time Signal, CT)**
    * **定义：** 信号在时间上是连续的，在任意一个时刻都有确定的值。可以想象成一条连续的曲线。
    * **表示：** 通常用 $x(t)$ 来表示，其中 $t$ 是连续的时间变量。
    * **例子：** 语音信号、模拟电视信号、温度变化曲线、电压电流随时间的变化。

* **离散时间信号 (Discrete-Time Signal, DT)**
    * **定义：** 信号只在某些离散的时刻有值，在其他时刻没有定义。可以想象成一系列独立的点。
    * **表示：** 通常用 $x[n]$ 来表示，其中 $n$ 是离散的整数变量，代表采样时刻。
    * **例子：** 数字音频信号（CD）、股票每日收盘价、计算机处理的图像像素值。

> **关键区别：** 连续时间信号的自变量是连续的，离散时间信号的自变量是离散的。离散时间信号通常是通过对连续时间信号进行**采样**（sampling）得到的。

* **周期信号 (Periodic Signal)**
    * **定义：** 信号在一定时间间隔后会重复出现。
    * **连续时间周期信号：** 存在一个正数 $T_0$ (基波周期)，使得 $x(t) = x(t + T_0)$ 对于所有 $t$ 都成立。
    * **离散时间周期信号：** 存在一个正整数 $N_0$ (基波周期)，使得 $x[n] = x[n + N_0]$ 对于所有整数 $n$ 都成立。
    * **例子：** 正弦波、方波、交流电。

* **非周期信号 (Aperiodic Signal)**
    * **定义：** 信号不重复出现，或者说找不到一个满足周期条件的 $T_0$ 或 $N_0$。
    * **例子：** 单位冲激信号、阶跃信号、一段语音（通常是非周期的）。

> 上述内容只是概念性的介绍，实际上尤其是离散周期信号是比较复杂的。

* **信号的能量 (Energy) $E$：**
    * **连续时间信号：** $E = \int_{-\infty}^{\infty} |x(t)|^2 dt$
    * **离散时间信号：** $E = \sum_{n=-\infty}^{\infty} |x[n]|^2$

* **信号的平均功率 (Average Power) $P$：**
    * **连续时间信号：** $P = \lim_{T \to \infty} \frac{1}{2T} \int_{-T}^{T} |x(t)|^2 dt$
    * **离散时间信号：** $P = \lim_{N \to \infty} \frac{1}{2N+1} \sum_{n=-N}^{N} |x[n]|^2$

* **能量信号 (Energy Signal)**
    * **定义：** 能量 $E$ 为一个有限正值 ($0 < E < \infty$)，而平均功率 $P = 0$。
    * **特点：** 信号在时间上是有限的，或者幅度会随着时间趋于无穷而衰减到零。
    * **例子：** 单位冲激信号、衰减指数信号 $e^{-at}u(t)$ ($a>0$)。

* **功率信号 (Power Signal)**
    * **定义：** 平均功率 $P$ 为一个有限正值 ($0 < P < \infty$)，而总能量 $E = \infty$。
    * **特点：** 信号持续时间无限长，且其幅度不会衰减到零。
    * **例子：** 周期信号（如正弦波、方波）、直流信号 $x(t) = C$。

#### 1.1.2 信号的变换

假设我们有一个信号 $x(t)$。

1.  **翻转 (Time Reversal / Folding)**
    * **运算：** $y(t) = x(-t)$
    * **效果：** 信号相对于时间轴 $t=0$ 进行翻转（镜像）。
    * **例子：** 如果 $x(t)$ 是从0开始上升的，那么 $x(-t)$ 就是从0开始下降的。

2.  **时移 (Time Shift)**
    * **运算：** $y(t) = x(t - t_0)$
    * **效果：**
        * 如果 $t_0 > 0$，信号向右（正方向）移动 $t_0$ 单位。这被称为**延迟** (delay)。
        * 如果 $t_0 < 0$，信号向左（负方向）移动 $|t_0|$ 单位。这被称为**超前** (advance)。
    * **记忆技巧：** $t-t_0$ ，“减” 表示向右移，“加” 表示向左移。想想 $x(t-2)$，原信号在 $t=0$ 的点现在要到 $t=2$ 才能出现，所以是右移。

3.  **尺度变换 (Time Scaling)**
    * **运算：** $y(t) = x(at)$
    * **效果：**
        * 如果 $|a| > 1$，信号被**压缩**。例如，$x(2t)$ 会比 $x(t)$ 变化得快一倍，持续时间缩短一半。
        * 如果 $0 < |a| < 1$，信号被**扩展**。例如，$x(t/2)$ 会比 $x(t)$ 变化得慢一倍，持续时间延长一倍。
        * 如果 $a < 0$，除了压缩或扩展外，还会伴随**翻转**（因为有负号）。

**组合运算：** 当这些运算组合在一起时，比如 $x(at - b)$，处理顺序很重要。通常建议先进行尺度变换和翻转，再进行时移，或者反过来。

* **方法一（先移后缩）：**
    1.  对 $x(t)$ 先进行时移：$x(t - t_{shift})$
    2.  再对结果进行尺度变换：$x(a(t - t_{shift})) = x(at - at_{shift})$。
        此时 $b = at_{shift}$，所以 $t_{shift} = b/a$。
        这意味着，如果信号是 $x(at-b)$，它相对于原信号向右移动了 $b/a$。

* **方法二（先缩后移）：**
    1.  对 $x(t)$ 先进行尺度变换：$x(at)$
    2.  再对结果进行时移：$x(a(t - t_{shift}')) = x(at - at_{shift}')$
        此时 $b = at_{shift}'$，所以 $t_{shift}' = b/a$。

无论哪种方法，最终结果都是一样的，但理解过程有助于避免混淆。最简单的方法是找到信号中的关键点，比如 $x(0)$ 对应的位置，然后计算新信号中该点位于何处。

例如，对于 $y(t) = x(2t - 4)$：
让 $2t - 4 = 0 \implies t = 2$。这意味着原信号在 $t=0$ 处的值，现在出现在新信号的 $t=2$ 处。所以它是向右移动了 2 个单位，并且被压缩了一半。

#### 1.1.3 基本信号

* **连续时间单位冲激信号 (Dirac Delta Function)**：用 $\delta(t)$ 表示。
    * **定义：**
        1.  $\delta(t) = 0$, 当 $t \neq 0$
        2.  $\int_{-\infty}^{\infty} \delta(t) dt = 1$
    * **物理意义：** 想象一个在 $t=0$ 时刻发生的一个**极短但强度极大**的“冲击”或“脉冲”，其持续时间无限接近于零，但其“面积”（或“能量”）为1。
    * **图像：** 通常用一个带箭头的竖直线表示，箭头旁边标上“1”表示其面积。
    * **重要性质：**
        * **抽样特性 (Sampling Property)：**
            $f(t)\delta(t) = f(0)\delta(t)$
            $\int_{-\infty}^{\infty} f(t)\delta(t-t_0) dt = f(t_0)$
            这意味着冲激信号可以“提取”出另一个信号在特定时刻的值。这个性质在系统分析中非常有用。
        * **时移冲激：** $\delta(t-t_0)$ 表示冲激发生在 $t_0$ 时刻。
        * **偶函数：** $\delta(t) = \delta(-t)$

* **离散时间单位冲激信号 (Unit Sample Sequence)**：用 $\delta[n]$ 表示。
    * **定义：**
        1.  $\delta[n] = 1$, 当 $n = 0$
        2.  $\delta[n] = 0$, 当 $n \neq 0$
    * **物理意义：** 在 $n=0$ 处有一个值为 1 的样本，其他地方都为 0。
    * **图像：** 在 $n=0$ 处画一个向上值为1的箭头（或点），其他点为0。
    * **重要性质：**
        * **抽样特性：**
            $f[n]\delta[n] = f[0]\delta[n]$
            $\sum_{n=-\infty}^{\infty} f[n]\delta[n-n_0] = f[n_0]$
        * **时移冲激：** $\delta[n-n_0]$ 表示冲激发生在 $n_0$ 时刻。
        * **偶函数：** $\delta[n] = \delta[-n]$

> **理解冲激信号：** 冲激信号就像一个“瞬间的力”或者一个“瞬间的事件”。在工程中，比如一个榔头敲击一下，或者一个闪电，都可以近似地看作是一个冲激信号。

* **连续时间单位阶跃信号**：用 $u(t)$ 表示。
    * **定义：**
        $u(t) = 1$, 当 $t \ge 0$
        $u(t) = 0$, 当 $t < 0$
    * **物理意义：** 表示一个信号从某一时刻开始“突然”从 0 变为 1 并保持。
    * **图像：** 在 $t=0$ 处有一个跳变，从 0 变为 1。
    * **与冲激信号的关系：**
        * 冲激信号是阶跃信号的导数：$\delta(t) = \frac{du(t)}{dt}$
        * 阶跃信号是冲激信号的积分：$u(t) = \int_{-\infty}^{t} \delta(\tau) d\tau$
        * 这个关系非常重要，它连接了冲激和阶跃这两个基本信号。

* **离散时间单位阶跃信号**：用 $u[n]$ 表示。
    * **定义：**
        $u[n] = 1$, 当 $n \ge 0$
        $u[n] = 0$, 当 $n < 0$
    * **与冲激信号的关系：**
        * $\delta[n] = u[n] - u[n-1]$ （离散冲激是两个阶跃信号的差分）
        * $u[n] = \sum_{k=-\infty}^{n} \delta[k]$ （离散阶跃是离散冲激的求和）

> **理解阶跃信号：** 阶跃信号就像一个“开关”，从某一时刻开始接通。比如，一个灯泡在某一刻突然被点亮，之后一直亮着。

* **连续时间实指数信号：** $x(t) = Ce^{at}$
    * **如果 $a > 0$：** 信号随时间**指数增长**。
    * **如果 $a < 0$：** 信号随时间**指数衰减**。
    * **如果 $a = 0$：** 信号是**直流信号** $x(t) = C$。
    * **与单位阶跃组合：** $x(t) = Ce^{at}u(t)$ 表示一个从 $t=0$ 开始的指数信号。

* **离散时间实指数信号：** $x[n] = C\alpha^n$
    * **如果 $|\alpha| > 1$：** 信号随 $n$ **指数增长**。
    * **如果 $0 < |\alpha| < 1$：** 信号随 $n$ **指数衰减**。
    * **如果 $\alpha = 1$：** 信号是**直流信号** $x[n] = C$。
    * **如果 $\alpha = -1$：** 信号在 $C$ 和 $-C$ 之间**交替变化**（振荡）。
    * **与单位阶跃组合：** $x[n] = C\alpha^n u[n]$ 表示一个从 $n=0$ 开始的指数信号。

> **理解指数信号：** 指数信号在自然界中非常常见，比如放射性衰变、电容器充放电、人口增长等。

* **连续时间正弦信号：** $x(t) = A\cos(\omega_0 t + \phi)$ 或 $A\sin(\omega_0 t + \phi)$
    * $A$ 是**幅度 (Amplitude)**。
    * $\omega_0$ 是**角频率 (Angular Frequency)**，单位是弧度/秒 (rad/s)。它决定了信号变化的快慢。
    * $\phi$ 是**相位 (Phase)**，单位是弧度 (rad)。它决定了信号波形相对于原点的偏移。
    * **周期 $T_0 = 2\pi / \omega_0$**
    * **频率 $f_0 = \omega_0 / (2\pi)$**，单位是赫兹 (Hz)。

* **复指数信号 (Complex Exponential Signal)：** $x(t) = Ce^{j\omega_0 t}$
    * 根据欧拉公式：$e^{j\theta} = \cos\theta + j\sin\theta$
    * 所以，$e^{j\omega_0 t} = \cos(\omega_0 t) + j\sin(\omega_0 t)$
    * **重要性：** 复指数信号是周期信号和非周期信号在频域分析（傅里叶分析）中的“基石”。任何正弦信号都可以表示为一对共轭复指数信号的和。
    * **在LTI系统中：** 复指数信号输入LTI系统，输出仍然是相同频率的复指数信号，只是幅度和相位可能发生变化。这是一个非常重要的性质。

* **离散时间正弦信号：** $x[n] = A\cos(\Omega_0 n + \phi)$ 或 $A\sin(\Omega_0 n + \phi)$
    * $\Omega_0$ 是**离散时间角频率 (Discrete-Time Angular Frequency)**，单位是弧度 (rad)。
    * **离散时间信号的周期性：** 与连续时间信号不同，离散时间正弦信号不一定都是周期信号。要使 $x[n]$ 周期为 $N_0$，必须满足 $\Omega_0 N_0 = 2\pi k$ (其中 $k$ 是整数)，即 $\Omega_0 / (2\pi) = k/N_0$ 必须是一个有理数。
    * **离散时间复指数信号：** $x[n] = Ce^{j\Omega_0 n}$
        * 它也具有类似连续时间复指数信号的重要性。
        * 值得注意的是，$e^{j(\Omega_0 + 2\pi)n} = e^{j\Omega_0 n}e^{j2\pi n} = e^{j\Omega_0 n} \cdot 1 = e^{j\Omega_0 n}$。这意味着在离散时间中，频率 $\Omega_0$ 和 $\Omega_0 + 2\pi$ 是等效的。所有独特的离散时间频率都位于一个 $2\pi$ 的区间内，例如 $[-\pi, \pi)$ 或 $[0, 2\pi)$。这在采样和数字信号处理中非常重要。

> **理解正弦信号：** 正弦信号是周期运动的数学描述，是自然界中最基本的振动形式。在电路、通信、声学等领域无处不在。

* **连续时间斜坡信号：** $r(t) = t u(t)$
    * **定义：**
        $r(t) = t$, 当 $t \ge 0$
        $r(t) = 0$, 当 $t < 0$
    * **图像：** 从 $t=0$ 开始以 45 度角向上倾斜的直线。
    * **与阶跃信号的关系：** 斜坡信号是阶跃信号的积分：$r(t) = \int_{-\infty}^{t} u(\tau) d\tau$

### 1.2 系统的基本概念

在信号与系统中，**系统（System）** 是处理信号的实体。它可以看作是一个“黑箱”，接收一个或多个输入信号，并产生一个或多个输出信号。

系统可以是物理设备（如电路、滤波器），也可以是数学模型（如描述物理过程的方程）。我们的目标是理解当给定一个输入信号时，系统会如何响应并产生输出信号。

通常，我们用 $y(t) = T\{x(t)\}$（连续时间）或 $y[n] = T\{x[n]\}$（离散时间）来表示系统，其中 $T$ 代表系统的变换或操作。

**线性**是系统最重要的性质之一，因为它极大地简化了系统分析。一个系统是线性的，必须同时满足**齐次性**和**叠加性**（或称可加性）。

* **齐次性 (Homogeneity)**：如果输入 $x(t)$ 产生输出 $y(t)$，那么输入 $ax(t)$ 会产生输出 $ay(t)$，其中 $a$ 是任意常数。
    * **数学表示：** $T\{ax(t)\} = aT\{x(t)\}$

* **叠加性 (Additivity)**：如果输入 $x_1(t)$ 产生输出 $y_1(t)$，输入 $x_2(t)$ 产生输出 $y_2(t)$，那么输入 $(x_1(t) + x_2(t))$ 会产生输出 $(y_1(t) + y_2(t))$。
    * **数学表示：** $T\{x_1(t) + x_2(t)\} = T\{x_1(t)\} + T\{x_2(t)\}$

* **线性系统定义：** 同时满足齐次性和叠加性的系统。可以合写为：
    $T\{a x_1(t) + b x_2(t)\} = a T\{x_1(t)\} + b T\{x_2(t)\} = a y_1(t) + b y_2(t)$

* **非线性系统：** 不满足线性条件的系统。
    * **例子：** $y(t) = x^2(t)$ (平方运算), $y(t) = \cos(x(t))$ (三角函数), $y(t) = x(t) + 1$ (有常数项或直流偏置的系统通常是非线性的，因为 $T\{ax(t)\} = ax(t)+1 \neq a(x(t)+1)$)

> **为什么线性重要？** 对于线性系统，我们只要知道它对几个基本信号的响应，就可以推导出它对任意复杂信号的响应。这在傅里叶分析和卷积等后续内容中会体现出来。

**时不变性**描述了系统参数是否随时间变化。

* **时不变系统定义：** 系统的特性不随时间变化。如果输入 $x(t)$ 产生输出 $y(t)$，那么将输入延迟（或超前）$t_0$ 单位时间，即 $x(t-t_0)$，将导致输出同样延迟（或超前）$t_0$ 单位时间，即 $y(t-t_0)$。
    * **数学表示：** 如果 $x(t) \xrightarrow{T} y(t)$，那么 $x(t-t_0) \xrightarrow{T} y(t-t_0)$。
    * **例子：** $y(t) = 2x(t)$ (放大器), $y(t) = \frac{dx(t)}{dt}$ (微分器)。它们的特性（放大倍数或微分操作）不随时间改变。

* **时变系统：** 系统的特性随时间变化的系统。
    * **例子：** $y(t) = tx(t)$ (乘上时间 $t$), $y(t) = \cos(t)x(t)$ (系统增益随时间变化)。一个随着时间老化的电子元件组成的电路，其特性也可能是时变的。

> **为什么时不变重要？** 结合线性性，线性时不变（**LTI**）系统是信号与系统课程中最重要的系统类型。LTI系统可以用**冲激响应**完全描述，这为时域（卷积）和频域（傅里叶变换、拉普拉斯变换等）分析提供了强大工具。

**因果性**关系到系统的输出是否只依赖于当前和过去的输入，而不依赖于未来的输入。

* **因果系统定义：** 系统的输出 $y(t)$（或 $y[n]$）仅取决于当前时刻 $t$（或 $n$）以及之前时刻的输入 $x(\tau)$（或 $x[k]$，其中 $\tau \le t$ 或 $k \le n$）。换句话说，系统不能“预知未来”。
    * **物理可实现性：** 所有的物理系统在实时运行时都必须是因果的。
    * **例子：** $y(t) = x(t-1)$ (延迟系统), $y(t) = \int_{-\infty}^{t} x(\tau)d\tau$ (积分器)。
    * **离散时间：** $y[n] = x[n] + x[n-1]$。

* **非因果系统：** 系统的输出依赖于未来的输入。
    * **例子：** $y(t) = x(t+1)$ (超前系统), $y(t) = x(t-1) + x(t+1)$。
    * **非物理可实现性：** 实时处理中，非因果系统是无法物理实现的。但在离线数据处理（比如图像处理，可以事先知道所有数据）或理论分析中，非因果系统是允许存在的。

**稳定性**是指系统在面对有界输入时，其输出是否也保持有界。

* **BIBO 稳定 (Bounded-Input Bounded-Output Stable) 定义：**
    如果对于任何有界输入信号 $x(t)$（即 $|x(t)| \le M_x < \infty$ 对于所有 $t$），系统的输出 $y(t)$ 也是有界的（即 $|y(t)| \le M_y < \infty$ 对于所有 $t$），那么系统是 BIBO 稳定的。
    * 简单来说，输入不会让输出“爆炸”或无限增长。

* **稳定系统：** 满足 BIBO 稳定条件的系统。
    * **LTI 系统的稳定性条件（提前了解，后续会详讲）：** 对于连续时间LTI系统，如果其冲激响应 $h(t)$ 绝对可积，即 $\int_{-\infty}^{\infty} |h(t)|dt < \infty$，则系统稳定。对于离散时间LTI系统，如果其冲激响应 $h[n]$ 绝对可和，即 $\sum_{n=-\infty}^{\infty} |h[n]| < \infty$，则系统稳定。
    * **例子：** $y(t) = \frac{1}{2}x(t)$。

* **不稳定系统：** 不满足 BIBO 稳定条件的系统。即使输入有界，输出也可能无界。
    * **例子：** 积分器 $y(t) = \int_{-\infty}^{t} x(\tau)d\tau$ 对于恒定输入 $x(t)=1$ 就会输出 $y(t)=t$，这是无界的，所以积分器是不稳定的。

* **无记忆系统定义：** 系统的输出在任何时刻只取决于**当前时刻**的输入。
    * **例子：** $y(t) = 2x(t)$ (放大器), $y(t) = x^2(t)$。
    * **离散时间：** $y[n] = x[n]$。

* **有记忆系统定义：** 系统的输出不仅取决于当前时刻的输入，还取决于**过去或未来**的输入。这意味着系统内部有“存储”过去信息的能力。
    * **例子：** $y(t) = x(t-1)$ (延迟系统), $y(t) = \int_{-\infty}^{t} x(\tau)d\tau$ (积分器，需要“记住”过去的输入值), $y(t) = \frac{dx(t)}{dt}$ (微分器，理论上需要知道输入在无穷小时间步内的变化)。
    * **离散时间：** $y[n] = x[n] + x[n-1]$。

### 1.3 采样与重构

在现实世界中，我们遇到的信号大多是**连续时间信号**（模拟信号），比如声音、温度、电压等。然而，计算机和数字系统只能处理**离散时间信号**（数字信号）。**采样**就是将连续时间信号转换为离散时间信号的过程，而**重构**则是尝试从离散时间信号恢复出原始的连续时间信号。

#### 1.3.1 采样

* **定义：** 采样是将一个连续时间信号 $x(t)$ 在一系列离散的时刻上进行测量，从而得到一个离散时间信号 $x[n]$ 的过程。
* **采样间隔 (Sampling Period) $T_s$：** 相邻采样点之间的时间间隔。
* **采样频率 (Sampling Frequency) $f_s$：** 每秒采样的次数， $f_s = 1/T_s$。对应的角频率为 $\omega_s = 2\pi f_s = 2\pi/T_s$。
* **数学表示：**
    一个简单的采样模型是将连续时间信号 $x(t)$ 乘以一个周期性的冲激串 $p(t) = \sum_{n=-\infty}^{\infty} \delta(t - nT_s)$：
    $x_s(t) = x(t)p(t) = \sum_{n=-\infty}^{\infty} x(nT_s)\delta(t - nT_s)$
    然后，离散时间信号 $x[n]$ 就是 $x(nT_s)$。

* **采样对频谱的影响：**
    当一个连续时间信号被采样后，其频谱会发生变化。原始信号 $X(j\omega)$ 的频谱会在频率轴上以 $\omega_s$ 为周期进行**周期延拓**（或称为**周期复制**）。
    $$X_s(j\omega) = \frac{1}{T_s} \sum_{k=-\infty}^{\infty} X(j(\omega - k\omega_s))$$
    这意味着，原始信号的频谱每隔 $\omega_s$ 就会复制一份。

#### 1.3.2 采样定理

这是采样理论中**最重要**的定理，它告诉我们为了无失真地从采样信号中恢复原始信号，需要满足什么条件。

* **核心思想：** 为了能够完美地从采样信号中重构出原始的连续时间信号，**采样频率 $f_s$ 必须至少是原始信号最高频率分量 $f_{max}$ 的两倍。**
    即：$f_s \ge 2f_{max}$，或者 $\omega_s \ge 2\omega_{max}$。

* **奈奎斯特频率 (Nyquist Frequency) $f_N = f_s/2$：** 这是采样频率的一半。
* **奈奎斯特速率 (Nyquist Rate) $2f_{max}$：** 这是完美重构所需的最小采样频率。

* **混叠 (Aliasing)：**
    如果采样频率不满足采样定理（即 $f_s < 2f_{max}$），那么在采样的频谱中，原始信号的周期复制会发生**重叠**。当重叠发生时，高频分量会“伪装”成低频分量，导致无法区分原始信号中的高频和低频，从而使得从采样信号中无法准确恢复出原始信号。这种现象称为**混叠**。

    * **如何避免混叠：**
        1.  **提高采样频率：** 确保 $f_s \ge 2f_{max}$。
        2.  **抗混叠滤波器 (Anti-aliasing Filter)：** 在采样之前，使用一个低通滤波器（称为抗混叠滤波器）滤除原始信号中高于奈奎斯特频率 $f_N$ 的所有频率分量。这确保了进入采样器的信号是**带宽受限**的，从而避免了混叠的发生。

#### 1.3.3 重构

**重构**是从离散时间信号 $x[n]$ 恢复出原始的连续时间信号 $x(t)$ 的过程。

* **理想重构：**
    如果采样满足采样定理（没有混叠），理论上可以通过一个**理想的低通滤波器（Ideal Low-Pass Filter）**来完美重构原始信号。
    * **理想低通滤波器特性：**
        * 在通带（$-\omega_N \le \omega \le \omega_N$ 或 $- \pi/T_s \le \omega \le \pi/T_s$）内，增益为 $T_s$。
        * 在阻带（通带之外）内，增益为 $0$。
    * **数学表示：**
        理想重构滤波器的频率响应为：
        $H_{rec}(j\omega) = \begin{cases} T_s, & |\omega| < \omega_s/2 \\ 0, & |\omega| \ge \omega_s/2 \end{cases}$
        通过这个滤波器，周期复制的频谱会被滤除，只留下中心位置的原始频谱。

* **实际重构：**
    在实际应用中，理想低通滤波器是无法物理实现的（因为它的冲激响应是非因果且无限长的）。我们通常使用**非理想的低通滤波器**进行近似重构，这会导致一定程度的失真。

    * **零阶保持 (Zero-Order Hold, ZOH)：** 最简单的重构方式之一，它将每个采样值保持恒定直到下一个采样点。这在数字-模拟转换器（DAC）中很常见。
    * **一阶保持 (First-Order Hold, FOH)：** 用直线连接相邻的采样点。

### 1.4 傅里叶变换

### 1.5 频域分析

#### 1.5.1 LTI系统的频率响应

我们知道，LTI系统对输入信号进行“操作”后得到输出信号。那么，如果输入的信号是一个**纯正弦波**（或者更广义地说是**复指数信号**），LTI系统会如何响应呢？

答案是：**LTI系统对复指数信号的响应仍然是同频率的复指数信号，只不过幅度会改变，相位会偏移。** 这个改变的幅度比例和偏移的相位量，就揭示了系统对该频率信号的“处理能力”，也就是它的**频率响应**。

在《信号与系统》中，我们常常使用**复指数信号** $e^{j\omega t}$ 来分析系统。
* $j$ 是虚数单位。
* $\omega$ 是角频率（rad/s）。
* $t$ 是时间。

为什么选择复指数信号呢？因为它是LTI系统的**特征函数（Eigenfunction）**。这意味着，当一个复指数信号 $e^{j\omega t}$ 作为输入 $x(t)$ 进入LTI系统时，输出 $y(t)$ 仍然是同频率的复指数信号，只是被一个**复常数** $H(j\omega)$ 缩放了：

$y(t) = H(j\omega) e^{j\omega t}$

这个复常数 $H(j\omega)$ 就是我们说的**频率响应**。

假设LTI系统的**冲激响应**是 $h(t)$。我们知道，对于LTI系统，输出 $y(t)$ 是输入 $x(t)$ 和冲激响应 $h(t)$ 的**卷积**：

$$y(t) = x(t) * h(t) = \int_{-\infty}^{\infty} x(\tau) h(t - \tau) d\tau$$

现在，我们让输入 $x(t) = e^{j\omega t}$：

$$y(t) = \int_{-\infty}^{\infty} e^{j\omega \tau} h(t - \tau) d\tau$$

为了把 $e^{j\omega t}$ 提出来，我们做变量替换：$u = t - \tau$，那么 $\tau = t - u$， $d\tau = -du$。积分上下限也会交换，所以：

$$y(t) = \int_{\infty}^{-\infty} e^{j\omega (t - u)} h(u) (-du) = \int_{-\infty}^{\infty} e^{j\omega t} e^{-j\omega u} h(u) du$$

我们可以把 $e^{j\omega t}$ 提出来，因为它与积分变量 $u$ 无关：

$$y(t) = e^{j\omega t} \int_{-\infty}^{\infty} h(u) e^{-j\omega u} du$$

看到积分部分了吗？$\int_{-\infty}^{\infty} h(u) e^{-j\omega u} du$ 这不就是**冲激响应 $h(t)$ 的傅里叶变换**吗！

所以，我们定义**频率响应 $H(j\omega)$ 为系统冲激响应 $h(t)$ 的傅里叶变换**：

$$
\boxed{
    H(j\omega) = \mathcal{F}\{h(t)\} = \int_{-\infty}^{\infty} h(t) e^{-j\omega t} dt
    }
$$

由于 $H(j\omega)$ 是一个复数（通常是复数，除非系统响应非常特殊），我们可以用**极坐标形式**来表示它：

$$H(j\omega) = |H(j\omega)| e^{j\phi(\omega)}$$

这里：
- **$|H(j\omega)|$ 是频率响应的“模”（Magnitude Response），也叫幅度响应。**   
- **$\phi(\omega)$ 是频率响应的“相位”（Phase Response）。**

**幅度响应 $|H(j\omega)|$**

* **定义：** 它表示LTI系统对不同频率的复指数信号（或正弦信号）的**幅度增益**。
* **物理意义：** 如果一个频率为 $\omega$ 的信号输入系统，它的幅度会乘以 $|H(j\omega)|$。
    * 如果 $|H(j\omega)| > 1$，系统在该频率下有**增益**（放大）。
    * 如果 $|H(j\omega)| < 1$，系统在该频率下有**衰减**（ attenuate）。
    * 如果 $|H(j\omega)| = 1$，系统在该频率下**幅度不变**。
* **应用：**
    * **滤波器设计：**
        * **低通滤波器：** 在低频段 $|H(j\omega)|$ 接近1，高频段 $|H(j\omega)|$ 接近0（通过低频，衰减高频）。
        * **高通滤波器：** 在高频段 $|H(j\omega)|$ 接近1，低频段 $|H(j\omega)|$ 接近0。
        * **带通滤波器：** 在某个频率带内 $|H(j\omega)|$ 接近1，其他频率接近0。
        * **带阻滤波器：** 在某个频率带内 $|H(j\omega)|$ 接近0，其他频率接近1。
    * **均衡器：** 音频设备中的均衡器就是通过调整不同频率的幅度响应来改变音质。

**相位响应 $\phi(\omega)$**

* **定义：** 它表示LTI系统对不同频率的复指数信号（或正弦信号）的**相位偏移**。
* **物理意义：** 如果一个频率为 $\omega$ 的信号输入系统，它的相位会增加 $\phi(\omega)$。
    * 正的 $\phi(\omega)$ 意味着相位提前。
    * 负的 $\phi(\omega)$ 意味着相位滞后。
    * 相位滞后 $-\phi(\omega)$ 对应着时间上的延迟 $\Delta t = \frac{-\phi(\omega)}{\omega}$。
* **物理意义举例：**
    * 想象一个理想的音频放大器，你希望它只放大声音，而不改变声音的“和谐度”或不同频率声音的“相对到达时间”。如果相位响应是非线性的，会导致不同频率分量的时间延迟不同，从而引起**相位失真**，使声音听起来模糊或不自然。
    * 在通信系统中，相位失真会影响信号的解调，导致数据错误。
    * **理想情况：** 对于不引起相位失真的系统，我们通常希望相位响应是频率的线性函数，即 $\phi(\omega) = -k\omega$ (其中 $k$ 是常数)。这意味着所有频率分量都延迟了相同的固定时间 $k$，即纯时延，不会改变信号的波形。

通常，我们通过绘制两个图来可视化LTI系统的频率响应：
1.  **幅度响应图：** $20 \log_{10} |H(j\omega)|$ (通常用分贝 dB 表示) 对 $\omega$ 绘制。
2.  **相位响应图：** $\phi(\omega)$ (用弧度或度数表示) 对 $\omega$ 绘制。

#### 1.5.2 传递函数

我们之前讨论了LTI系统的**冲激响应 $h(t)$** 和**频率响应 $H(j\omega)$**。它们都是描述系统特性的方法。

传递函数 $H(s)$ 可以认为是频率响应 $H(j\omega)$ 的一个更广义的版本，它是系统冲激响应 $h(t)$ 的**拉普拉斯变换 (Laplace Transform)**：

$$H(s) = \mathcal{L}\{h(t)\} = \int_{0^{-}}^{\infty} h(t) e^{-st} dt$$

* 这里的 $s$ 是一个**复变量**，通常写成 $s = \sigma + j\omega$。
    * 当 $\sigma = 0$ 时，即 $s = j\omega$，拉普拉斯变换就退化成了傅里叶变换。所以，**频率响应 $H(j\omega)$ 其实就是传递函数 $H(s)$ 在虚轴上的取值。**
* 拉普拉斯变换的引入，主要是为了更方便地处理**非稳态（暂态）信号**和**初始条件**，同时也能描述**不稳定系统**（傅里叶变换要求系统稳定）。它在分析电路、控制系统等领域非常常用。

对于一个LTI系统，如果输入是 $X(s)$ （输入信号的拉普拉斯变换），输出是 $Y(s)$ （输出信号的拉普拉斯变换），那么：

$$Y(s) = H(s) X(s)$$

所以，**传递函数 $H(s)$ 也可以定义为系统输出的拉普拉斯变换与输入拉普拉斯变换之比**，且默认所有初始条件为零。

$$H(s) = \frac{Y(s)}{X(s)}$$ (在零初始条件下)

对于大多数由线性微分方程描述的LTI系统（比如RC电路、RLC电路、机械系统等），它们的传递函数通常可以表示为 $s$ 的**有理分式**，也就是两个多项式的比值：

$$H(s) = \frac{N(s)}{D(s)} = \frac{b_m s^m + b_{m-1} s^{m-1} + \dots + b_1 s + b_0}{a_n s^n + a_{n-1} s^{n-1} + \dots + a_1 s + a_0}$$

* $N(s)$ 是分子多项式。
* $D(s)$ 是分母多项式。
* $b_i$ 和 $a_i$ 是常数系数。

**零点与极点**

* **零点 (Zeros)：** 是使传递函数 $H(s)$ 的**分子 $N(s)$ 等于零**的 $s$ 值。
    * 如果 $s=z_k$ 是一个零点，那么 $H(z_k)=0$。
    * 在这些频率（如果 $z_k$ 在虚轴上）或 $s$ 平面上的这些点，系统对输入信号的响应为零。可以想象成，在这些频率下，系统“拒绝”信号通过。
* **极点 (Poles)：** 是使传递函数 $H(s)$ 的**分母 $D(s)$ 等于零**的 $s$ 值。
    * 如果 $s=p_k$ 是一个极点，那么 $H(p_k) \to \infty$。
    * 在这些频率（如果 $p_k$ 在虚轴上）或 $s$ 平面上的这些点，系统对输入信号的响应会变得无穷大。这通常与系统的**固有模式**或**自然响应**有关。极点的位置决定了系统的稳定性和响应特性。

我们把分子和分母多项式进行因式分解，就可以把传递函数写成**零点-极点形式**：

$$H(s) = K \frac{(s-z_1)(s-z_2)\dots(s-z_m)}{(s-p_1)(s-p_2)\dots(s-p_n)}$$

* $z_1, z_2, \dots, z_m$ 是零点。
* $p_1, p_2, \dots, p_n$ 是极点。
* $K$ 是一个常数增益因子。

**为什么是 $(s-z_k)$ 和 $(s-p_k)$ 的形式？**
举个例子，如果 $s=2$ 是一个零点，那么当 $s=2$ 时 $N(s)$ 必须为零，所以 $(s-2)$ 必然是 $N(s)$ 的一个因子。同理，极点也是这样。

### 1.5.3 从传递函数到频域响应（重要）

### 1.5.3 Bode 图与稳定裕度分析

## 2 基本控制理论

### 2.1 从经典控制原理开始

### 2.2 控制理论的现代描述

## 3 反馈控制与鲁棒控制

#### 3.x.x 卡尔曼滤波

> 卡尔曼滤波的最优性体现在哪？

卡尔曼滤波（Kalman Filter, KF）的“最优性”是一个在特定假设下才成立的、有严格数学定义的结论。简而言之，卡尔曼滤波的“最优性”体现在：**在线性高斯系统（Linear-Gaussian system）的假设下，它是最小均方误差（Minimum Mean Squared Error, MMSE）估计器。**

这意味着，在所有可能的估计方法中（无论线性的还是非线性的），卡尔曼滤波给出的状态估计值 ($\hat{x}$) 是最接近真实状态 ($x$) 的，其“接近”的衡量标准是“均方误差”$E[\|x - \hat{x}\|^2]$ 最小。

卡尔曼滤波器的核心目标是最小化 **“后验”估计误差的协方差矩阵 ($P_k$)**。

* **真实状态 (True State):** $x_k$
* **估计状态 (Estimated State):** $\hat{x}_k$
* **估计误差 (Estimation Error):** $e_k = x_k - \hat{x}_k$
* **误差协方差 (Error Covariance):** $P_k = E[e_k e_k^T] = E[(x_k - \hat{x}_k)(x_k - \hat{x}_k)^T]$

“最优”意味着卡尔曼滤波选择了一个算法（具体来说，是卡尔曼增益 $K_k$），使得这个 $P_k$ 矩阵的“大小”最小。在数学上，这通常指最小化 $P_k$ 的迹（Trace），即 $min(tr(P_k))$。最小化迹等价于最小化所有状态变量的估计误差方差之和，这也就是**最小均方误差 (MMSE)** 的含义。

我们来看更新步骤的核心公式：
$$
\hat{x}_k = \hat{x}_k^- + K_k (z_k - H \hat{x}_k^-)
$$
其中：
* $\hat{x}_k^-$ 是**先验估计**（来自预测步骤）。
* $z_k$ 是当前的**测量值**。
* $(z_k - H \hat{x}_k^-)$ 是**测量残差**（Innovation）。
* $K_k$ 是**卡尔曼增益**，它决定了我们应该“多大程度上”相信这个新的测量值。

我们的目标是选择一个 $K_k$，使得“事后”误差协方差 $P_k$ 最小。

$P_k$ 的推导如下：
$$
P_k = E[e_k e_k^T] = E[(x_k - \hat{x}_k)(x_k - \hat{x}_k)^T]
$$
将 $\hat{x}_k$ 的更新公式代入：
$$
\begin{aligned}
x_k - \hat{x}_k &= x_k - [\hat{x}_k^- + K_k (z_k - H \hat{x}_k^-)] \\
&= x_k - \hat{x}_k^- - K_k (H x_k + v_k - H \hat{x}_k^-) \quad (\text{因为 } z_k = H x_k + v_k) \\
&= (x_k - \hat{x}_k^-) - K_k H (x_k - \hat{x}_k^-) - K_k v_k \\
&= (I - K_k H) (x_k - \hat{x}_k^-) - K_k v_k \\
&= (I - K_k H) e_k^- - K_k v_k
\end{aligned}
$$
（其中 $e_k^-$ 是先验误差，$v_k$ 是测量噪声）

现在我们计算 $P_k = E[( (I - K_k H) e_k^- - K_k v_k ) ( (I - K_k H) e_k^- - K_k v_k )^T]$。
假设先验误差 $e_k^-$ 和测量噪声 $v_k$ 是不相关的（这是KF的标准假设之一），交叉项的期望为0：
$$
\begin{aligned}
P_k &= (I - K_k H) E[e_k^- (e_k^-)^T] (I - K_k H)^T + K_k E[v_k v_k^T] K_k^T \\
&= (I - K_k H) P_k^- (I - K_k H)^T + K_k R K_k^T
\end{aligned}
$$
（其中 $P_k^-$ 是先验协方差，$R$ 是测量噪声协方差）

**这就是最优性的关键所在：**
我们的目标是找到一个 $K_k$，使得 $tr(P_k)$ 最小。
$$
P_k = P_k^- - K_k H P_k^- - P_k^- H^T K_k^T + K_k H P_k^- H^T K_k^T + K_k R K_k^T
$$
为了求 $tr(P_k)$ 关于 $K_k$ 的极值，我们计算 $tr(P_k)$ 对 $K_k$ 的导数，并令其为0：
$$
\frac{d(tr(P_k))}{dK_k} = -2(P_k^- H^T)^T + 2K_k (H P_k^- H^T + R) = 0
$$
整理得到：
$$
K_k (H P_k^- H^T + R) = P_k^- H^T
$$
最终解出 $K_k$：
$$
K_k = P_k^- H^T (H P_k^- H^T + R)^{-1}
$$
**结论：** 卡尔曼增益 $K_k$ **不是拍脑袋定下的，而是通过最小化事后估计误差协方差 $P_k$ 这个目标严格推导出来的**。这个 $K_k$ 值是唯一能使 $P_k$ 最小的最优解。

卡尔曼滤波的“最优性”有两个层次，这取决于我们对噪声的假设有多强。

**层面 1：最佳线性无偏估计 (BLUE)**

如果系统满足以下条件：
1.  **线性**系统模型 ($x_k = F x_{k-1} + ...$, $z_k = H x_k + ...$)
2.  噪声 $w_k$ (过程噪声) 和 $v_k$ (测量噪声) 的**均值为零**。
3.  噪声 $w_k$ 和 $v_k$ 是**不相关**的白噪声。
4.  噪声的协方差 $Q$ 和 $R$ 已知。

**注意：这个层面不要求噪声是高斯分布！**

在这种条件下，卡尔曼滤波器是**最佳线性无偏估计器（Best Linear Unbiased Estimator, BLUE）**。
* **无偏 (Unbiased):** 估计的期望值等于真实值的期望值 ($E[\hat{x}_k] = E[x_k]$)。
* **线性 (Linear):** 估计值 $\hat{x}_k$ 是所有历史测量值 $z_1, ..., z_k$ 的线性组合。
* **最佳 (Best):** 在所有其他线性和无偏的估计器中，卡尔曼滤波器的均方误差（即 $P_k$ 的迹）是最小的。

**层面 2：最小均方误差 (MMSE)**

如果我们**额外增加一个条件**：
5.  噪声 $w_k$ 和 $v_k$ 服从**高斯分布（Gaussian）**。

由于高斯分布的优良特性（高斯分布经过线性变换后仍然是高斯分布），卡尔曼滤波器此时升级为**最小均方误差（MMSE）估计器**。

* **MMSE:** 此时，卡尔曼滤波不仅在*线性*估计器中是最优的，它在*所有*估计器中（包括各种复杂的**非线性**估计器）也是最优的。
* **贝叶斯视角：** 在线性高斯假设下，卡尔曼滤波的估计值 $\hat{x}_k$ 不仅仅是一个估计值，它还是后验概率分布 $p(x_k | z_{1:k})$ 的**均值（Mean）**。而对于高斯分布来说，其均值、中位数和众数是同一个点，这个点恰好就是MMSE估计。

理解了最优性的来源，也就理解了为什么会有那么多KF的变种：

* **如果系统不是线性的 (Linearity fails):** KF不再是BLUE，更不是MMSE。
    * **解决方案：** 扩展卡尔曼滤波 (EKF) 或 无迹卡尔曼滤波 (UKF)。它们试图通过线性化或采样来逼近真实系统，但它们都**不是最优的**，只是次优 (Sub-optimal) 的近似。
* **如果噪声不是高斯的 (Gaussianity fails):** KF只是BLUE，不再是MMSE。
    * **解决方案：** 粒子滤波 (Particle Filter)。粒子滤波通过蒙特卡洛采样来逼近真实的后验概率分布，在粒子数足够多时，它可以逼近MMSE，但计算量远大于KF。

> 思考：为什么“高斯分布”假设如此特殊，能让 KF 从“最佳线性”升级为“最佳（全局）”估计器？